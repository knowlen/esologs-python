# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview
This is a Python client library for the ESO Logs API v2, providing a GraphQL-based interface to access Elder Scrolls Online combat logging data. The library is in active development (v0.2.0-alpha) with ~20% API coverage, targeting 95%+ coverage. Built using `ariadne-codegen` for GraphQL code generation with both synchronous and asynchronous client implementations.

## Essential Development Commands

### Installation and Setup
```bash
# Install dependencies
pip install -e .

# Development installation with all tools
pip install -e ".[dev]"

# Install pre-commit hooks
pre-commit install
```

### Code Generation
```bash
# Generate GraphQL client code from schema
ariadne-codegen
```
This uses `mini.toml` configuration to generate Python client code from `schema.graphql` and `queries.graphql`.

### Testing
```bash
# Run comprehensive API tests (requires API credentials)
python test.py
```

### Code Quality
```bash
# Run all code quality checks
pre-commit run --all-files

# Individual tools
black .                    # Code formatting
isort .                    # Import sorting  
ruff check .               # Linting
ruff check --fix .         # Auto-fix linting issues
mypy .                     # Type checking
```

### Development with pyproject.toml
```bash
# Future installation method (when pyproject.toml is fully implemented)
pip install -e ".[dev]"

# Run tests with pytest (when test suite is available)
pytest tests/
```

## Project Architecture

### Core Components
- **`esologs/client.py`**: Main async client class with all API methods - contains hand-written GraphQL queries embedded as strings
- **`esologs/async_base_client.py`**: Base async GraphQL client with HTTP/WebSocket support
- **`access_token.py`**: OAuth2 authentication handler using client credentials flow
- **`esologs/base_model.py`**: Base Pydantic models and utilities
- **`esologs/enums.py`**: GraphQL enum definitions
- **`esologs/exceptions.py`**: Custom exception classes for GraphQL errors

### Generated Code Structure
The majority of files in the `esologs/` directory are auto-generated by `ariadne-codegen`:
- `get_*.py` files: Individual query implementations with typed response models
- `input_types.py`: Input type definitions
- Each query has its own module with fully typed Pydantic response models
- All generated classes are exported through `__init__.py` with comprehensive `__all__` list

### Authentication Flow
- OAuth2 client credentials flow using `access_token.py`
- Requires `ESOLOGS_ID` and `ESOLOGS_SECRET` environment variables
- API endpoint: `https://www.esologs.com/api/v2/client`
- Alternatively supports `.env` file with same variable names

### API Coverage & Architecture
Currently implements ~25% of API functionality:
- **Game Data**: abilities, classes, factions, items, item sets, maps, NPCs
- **Character Data**: character info, reports, encounter rankings, **character rankings (NEW)**
- **World Data**: regions, zones, encounters
- **Guild Data**: guild information
- **Report Data**: individual report retrieval by code
- **System**: rate limiting information

**Recently Added (Phase 2 PR #1)**:
- **Character Rankings**: `get_character_encounter_rankings()` and `get_character_zone_rankings()`
- Full support for all ranking metrics (dps, hps, playerscore, etc.)
- Comprehensive filtering options (role, difficulty, timeframe, etc.)
- Proper Pydantic response models and enum support

Missing major functionality (~75%) includes detailed report analysis, advanced search, user account integration, and progress race tracking.

## Configuration Files
- **`mini.toml`**: ariadne-codegen configuration
- **`pyproject.toml`**: Complete project configuration with dependencies, dev tools, code quality tools, and build settings
- **`.pre-commit-config.yaml`**: Pre-commit hooks for code quality (black, isort, ruff, mypy)
- **`schema.graphql`**: GraphQL schema definition
- **`queries.graphql`**: GraphQL queries for code generation

## Code Quality Configuration
- **Black**: Line length 88, excludes generated `get_*.py` files
- **isort**: Black-compatible profile, excludes generated files
- **Ruff**: Extensive linting with pycodestyle, pyflakes, isort, bugbear, comprehensions, pyupgrade
- **MyPy**: Strict type checking with generated files excluded
- **pytest**: Configured with coverage reporting, async support, and test markers

## Development Workflow
1. All API responses are validated using Pydantic models
2. GraphQL queries are embedded as strings in client methods using `gql()` helper
3. Generated code is excluded from code quality checks
4. Library supports both HTTP and WebSocket connections for subscriptions
5. Rate limiting information is available through the API
6. `test.py` provides comprehensive testing of all API endpoints with real API calls

## Key Implementation Details
- Uses `AsyncBaseClient` as base class for all GraphQL operations
- Client methods are async/await throughout
- Generated response models provide full type safety
- OAuth2 token management is handled separately in `access_token.py`
- All generated files are systematically excluded from linting and type checking
- Development focuses on expanding API coverage while maintaining generated code boundaries